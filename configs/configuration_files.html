

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuration files &mdash; OpusDistillery  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dataset importers" href="downloading_and_selecting_data.html" />
    <link rel="prev" title="Basic usage" href="../usage.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> OpusDistillery
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Get started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Basic usage</a></li>
</ul>
<p class="caption"><span class="caption-text">Setting up your experiment</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data-processing">Data processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#opusfilter">OpusFilter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bicleaner-ai">Bicleaner AI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#teacher-models">Teacher models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#backward-models">Backward models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multilinguality">Multilinguality</a></li>
<li class="toctree-l2"><a class="reference internal" href="#training">Training</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#marian-arguments">Marian arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#opustrainer">Opustrainer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other">Other</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="downloading_and_selecting_data.html">Dataset importers</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples of Configuration Files</a></li>
</ul>
<p class="caption"><span class="caption-text">The pipeline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pipeline/steps.html">Pipeline steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline/dir_structure.html">Directory structure</a></li>
</ul>
<p class="caption"><span class="caption-text">Other information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpusDistillery</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Configuration files</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuration-files">
<h1>Configuration files<a class="headerlink" href="#configuration-files" title="Permalink to this headline">¶</a></h1>
<p>Configuration files are in <a class="reference external" href="https://yaml.org/">YAML</a> format.
At the top level, they have two sections:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">experiment</span></code>: contains all the relevant information for your experiment, except the information on which datasets to use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">datasets</span></code>: contains the infromation regarding the datasets used for training, development and evaluation. Datasets are explained in <a class="reference internal" href="downloading_and_selecting_data.html"><span class="doc std std-doc">Dataset importers</span></a>.</p></li>
</ul>
<p>At the beginning of your <code class="docutils literal notranslate"><span class="pre">experiment</span></code> section, you should define the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dirname</span></code>: directory name where everything will be stored.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: name of the experiment you are running. All generated data and models will be stored in <code class="docutils literal notranslate"><span class="pre">dirname</span></code>/<code class="docutils literal notranslate"><span class="pre">name</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">langpairs</span></code>: a list of the language pairs you want in your student model, with <strong>two letter codes</strong></p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">experiment</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dirname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fiu-eng</span>
<span class="w">  </span><span class="nt">langpairs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">et-en</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fi-en</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hu-en</span>
</pre></div>
</div>
<div class="section" id="data-processing">
<h2>Data processing<a class="headerlink" href="#data-processing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="opusfilter">
<h3>OpusFilter<a class="headerlink" href="#opusfilter" title="Permalink to this headline">¶</a></h3>
<p>We have added support for using <a class="reference external" href="https://github.com/Helsinki-NLP/OpusFilter">OpusFilter</a>, a tool for filtering and combining parallel corpora. For data filtering, instead of the default cleaning, you can choose to use opusfilter with a default configuration or with a specific configuration you provide.</p>
<p>In the configuration file, if you want to use a <a class="reference external" href="https://github.com/Helsinki-NLP/OpusDistillery/blob/multi-ftt/configs/pipeline/clean/run-opusfilter.py#13">default</a> configuration, you can see how in <a class="reference external" href="https://github.com/Helsinki-NLP/OpusDistillery/blob/multi-ftt/configs/configs/opusfilter/config.fiu-eng.opusfilter.yml#L33">this example</a>. Otherwise, you can specify the path to a specific file with an Opusfilter configuration such as <a class="reference external" href="https://github.com/Helsinki-NLP/OpusDistillery/blob/multi-ftt/configs/configs/opusfilter/config.opusfilter.yml">this one</a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusfilter</span><span class="p">:</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"> </span><span class="c1"># Otherwise, specify path to opusfilter configuration &#39;configs/opusfilter/config.opusfilter.yaml&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="bicleaner-ai">
<h3>Bicleaner AI<a class="headerlink" href="#bicleaner-ai" title="Permalink to this headline">¶</a></h3>
<p>At the moment, this is not working.</p>
</div>
</div>
<div class="section" id="teacher-models">
<h2>Teacher models<a class="headerlink" href="#teacher-models" title="Permalink to this headline">¶</a></h2>
<p>At the moment, the type of teacher models available are only OPUS-MT (HuggingFace models coming soon!).</p>
<p>It is defined by:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">opusmt-teacher</span></code></p></li>
</ul>
<p>This can be either of the following:</p>
<ol class="simple">
<li><p>the URL to an OPUS-MT model</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusmt-teacher</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/fiu-eng/opus4m-2020-08-12.zip&quot;</span>
</pre></div>
</div>
<ol class="simple">
<li><p>the path to an OPUS-MT model,</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusmt-teacher</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/opus-mt/model&quot;</span>
</pre></div>
</div>
<ol class="simple">
<li><p>a list of OPUS-MT models that will be used all together (any combination of the previous two).</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusmt-teacher</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/gem-gem/opus-2020-10-04.zip&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/eng-swe/opus+bt-2021-04-14.zip&quot;</span>
</pre></div>
</div>
<ol class="simple">
<li><p>In the case of multilingual students, you can combine different teachers. In this case, it should be a dictionary, specifying each teacher per language pair.</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusmt-teacher</span><span class="p">:</span>
<span class="w">    </span><span class="nt">en-uk</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/eng-ukr/opus+bt-2021-04-14.zip&quot;</span>
<span class="w">    </span><span class="nt">en-ru</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/eng-rus/opus+bt-2021-04-14.zip&quot;</span>
<span class="w">    </span><span class="nt">en-be</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/eng-bel/opus+bt-2021-03-07.zip&quot;</span>
</pre></div>
</div>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">best</span></code> which will select the best teacher available for each language pair by checking the FLORES200+ scores from the <a class="reference external" href="https://opus.nlpl.eu/dashboard">OPUS-MT dashboard</a>.</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusmt-teacher</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;best&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="backward-models">
<h2>Backward models<a class="headerlink" href="#backward-models" title="Permalink to this headline">¶</a></h2>
<p>At the moment, the type of teacher models available are only OPUS-MT (HuggingFace models coming soon!).</p>
<p>It is defined by:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">opusmt-backward</span></code>: the URL or path to an OPUS-MT model to be used as a backward model for scoring translations. As the teacher, it can also be a dictionary specifying a backward model per language pair as well as <code class="docutils literal notranslate"><span class="pre">best</span></code>.</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusmt-backward</span><span class="p">:</span>
<span class="w">    </span><span class="nt">uk-en</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/ukr-eng/opus+bt-2021-04-30.zip&quot;</span>
<span class="w">    </span><span class="nt">ru-en</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/rus-eng/opus+bt-2021-04-30.zip&quot;</span>
<span class="w">    </span><span class="nt">be-en</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/bel-eng/opus+bt-2021-04-30.zip&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="multilinguality">
<h2>Multilinguality<a class="headerlink" href="#multilinguality" title="Permalink to this headline">¶</a></h2>
<p>Specify if the teacher, the backward and the student models are many-to-one to be able to deal properly with language tags. By default, this is  <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">one2many-teacher</span></code>: <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> (default). If <code class="docutils literal notranslate"><span class="pre">opusmt-teacher</span></code> is “best”, then this should be also “best”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">one2many-backward</span></code>: <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> (default). If <code class="docutils literal notranslate"><span class="pre">opusmt-backward</span></code> is “best”, then this should be also “best”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">one2many-student</span></code>: <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> (default).</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify if the teacher and the student are many2one</span>
<span class="w">  </span><span class="nt">one2many-teacher</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="nt">one2many-student</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
</div>
<div class="section" id="training">
<h2>Training<a class="headerlink" href="#training" title="Permalink to this headline">¶</a></h2>
<div class="section" id="marian-arguments">
<h3>Marian arguments<a class="headerlink" href="#marian-arguments" title="Permalink to this headline">¶</a></h3>
<p>These configs override pipeline/train/configs with <a class="reference external" href="https://marian-nmt.github.io/docs/cmd/marian/">Marian settings</a></p>
<p>The options are: <code class="docutils literal notranslate"><span class="pre">training-teacher</span></code>, <code class="docutils literal notranslate"><span class="pre">decoding-teacher</span></code>,<code class="docutils literal notranslate"><span class="pre">training-backward</span></code>, <code class="docutils literal notranslate"><span class="pre">decoding-backward</span></code>,<code class="docutils literal notranslate"><span class="pre">training-student</span></code>, <code class="docutils literal notranslate"><span class="pre">training-student-finetuned</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">marian-args</span><span class="p">:</span>
<span class="w">  </span><span class="c1">#these configs override pipeline/train/configs</span>
<span class="w">  </span><span class="nt">training-student</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dec-depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">    </span><span class="nt">enc-depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">    </span><span class="nt">dim-emb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512</span>
<span class="w">    </span><span class="nt">tied-embeddings-all</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">transformer-decoder-autoreg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rnn</span>
<span class="w">    </span><span class="nt">transformer-dim-ffn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2048</span>
<span class="w">    </span><span class="nt">transformer-ffn-activation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">relu</span>
<span class="w">    </span><span class="nt">transformer-ffn-depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">transformer-guided-alignment-layer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">last</span>
<span class="w">    </span><span class="nt">transformer-heads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
<span class="w">    </span><span class="nt">transformer-postprocess</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dan</span>
<span class="w">    </span><span class="nt">transformer-preprocess</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">    </span><span class="nt">transformer-tied-layers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">    </span><span class="nt">transformer-train-position-embeddings</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">transformer</span>
</pre></div>
</div>
</div>
<div class="section" id="opustrainer">
<h3>Opustrainer<a class="headerlink" href="#opustrainer" title="Permalink to this headline">¶</a></h3>
<p>We have also added support for using <a class="reference external" href="https://github.com/hplt-project/OpusTrainer">OpusTrainer</a>, a tool for curriculum training and data augmentation.</p>
<p>In the configuration file, you can specify a path to the OpusTrainer configuration as in <a class="reference external" href="https://github.com/Helsinki-NLP/OpusDistillery/blob/multi-ftt/configs/opustrainer/config.fiu-eng.opustrainer.yml#L37">here</a>. However, this assumes that you already now the final paths of the data as specified in <a class="reference external" href="https://github.com/Helsinki-NLP/OpusDistillery/blob/multi-ftt/configs/opustrainer/config.fiu-eng.opustrainer.stages.yml">here</a>.</p>
<p>At the moment, this is only implemented for student training.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opustrainer</span><span class="p">:</span>
<span class="w">    </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">student</span><span class="w"> </span><span class="c1"># Ideally, could be teacher or backward</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;configs/opustrainer/config.fiu-eng.opustrainer.stages.yml&quot;</span><span class="w"> </span><span class="c1"># This assumes you already know the paths to the data</span>
</pre></div>
</div>
</div>
<div class="section" id="other">
<h3>Other<a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parallel-max-sentences</span></code>: maximum parallel sentences to download from each dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">split-length</span></code>: the amount of sentences into which you want to split your training data for forward translation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">best-model</span></code>: metric to select your best model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spm-sample-size</span></code>: sample size to train spm vocabulary of the student.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">student-prefix</span></code>: in case you want to train multiple students with exactly the same data, you can add this prefix which will allow you to train multiple students in the same directory structure. Find more about the directory structure <a class="reference internal" href="../pipeline/dir_structure.html"><span class="doc std std-doc">here</span></a>.</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="downloading_and_selecting_data.html" class="btn btn-neutral float-right" title="Dataset importers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../usage.html" class="btn btn-neutral float-left" title="Basic usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>